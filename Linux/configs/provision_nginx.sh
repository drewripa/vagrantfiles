#!/bin/sh

echo "========================================================================="
echo "========================== Updates ======================================"
echo "========================================================================="
yum -y update

echo "========================================================================="
echo "========================== NGINX service ================================"
echo "========================================================================="
systemctl start httpd
systemctl enable httpd

echo "========================================================================="
echo "========================== Clone Repos =================================="
echo "========================================================================="
mkdir -p /nginx/src
mkdir -p /nginx/modules/rtmp
cd /nginx/src
git clone https://github.com/nginx/nginx.git .
cd /nginx/modules/rtmp
git clone https://github.com/arut/nginx-rtmp-module.git .

echo "========================================================================="
echo "========================== Make ========================================="
echo "========================================================================="
cd /nginx/src/auto
./configure --add-module=/nginx/modules/rtmp --with-http_ssl_module
make
make install

echo "========================================================================="
echo "========================== Test ========================================="
echo "========================================================================="

echo "rtmp {}" >> /etc/nginx/nginx.conf

systemctl restart nginx
systemctl status nginx
